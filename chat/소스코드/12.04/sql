create table user(
userno int AUTO_INCREMENT primary key ,
id varchar(20) not null unique ,
pw varchar(255) not null,
salt varchar(255),
name varchar(100) not null,
email varchar(30) not null check(email like '%@%'),
role varchar(20) default 'user', /* 권한 user,admin */  
is_logged_in TINYINT(1) DEFAULT 0 COMMENT '로그인 상태',
session_id VARCHAR(100) NULL COMMENT '세션 ID',
login_time DATETIME NULL COMMENT '로그인 시간',
last_activity DATETIME NULL COMMENT '마지막 활동 시간',
created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '계정 생성일',
updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일',
is_active TINYINT(1) DEFAULT 1 COMMENT '계정 활성화',
readmessage int(1) comment '메시지 읽음 처리'
);

create table friend(
request_id int auto_increment primary key,
requester_id varchar(20) comment '친구 요청을 보낸 user id',
receiver_id varchar(20) comment '친구 요청을 받은 user id',
status tinyint(1) default 0 comment '1: 초대를 보냄 , 2: 초대 수락(친구 상태)',
foreign key (requester_id) references user(id),
foreign key (receiver_id) references user(id)
);

create table chat(
ChatRoomId int AUTO_INCREMENT primary key, /* 방 번호 */
num int default 1/* 인원수 */,
ChatType int not null check (ChatType in(1, 2)) default 2, /* 1: 일반 채팅(비번 있음) , 2 : 공개 채팅 비번 x */
chatpw varchar(50) default '',
chatroomname varchar(50) not null
);

create table chating(
c_no int AUTO_INCREMENT primary key,
ChatRoomId int not null,
userno int,
contents varchar(100), /* 글 내용 */
nowtime datetime default current_timestamp /* 현재 시간 */,
img varchar(255),	
file varchar(255),
day varchar(100)
,foreign key(ChatRoomId) references chat(ChatRoomId)
,foreign key(userno) references user(userno)
);

CREATE TABLE chat_user (
  ChatRoomId INT NOT NULL,
  UserNo INT NOT NULL,
  PRIMARY KEY (ChatRoomId, UserNo),
  FOREIGN KEY (ChatRoomId) REFERENCES chat(ChatRoomId),
  FOREIGN KEY (UserNo) REFERENCES user(UserNo)
);
