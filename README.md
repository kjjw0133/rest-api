### 실행 방법,설정
1. 소스코드만 공개 된다는 가정하고 설명,델파이에서 VCL, DB는 mysql을 사용, mysql libmysql.dll파일 설치 해야지 db랑 연결
2. db와 연결되었으면 소스코드를 전부 복사해서 Project1에 넣기, Project2를 만든 후 Server를 넣어줌
3. 실행하기 전 Project -> options -> Application -> Froms -> Auto-create forms(Form1,2,3,4,5,6,7,8), Availabel forms(Form9,10,11,13)을 넣고 저장
4. 서버가 있는 Project.exe 파일을 Run으로 실행, 그리고 클라이언트(Form1)가 있는 Project.exe을 Run Without Debugging
---

### chat 
1. 로그인 중복 방지 처리
2. 비밀번호 SHA + salt 사용하여 보안 강화
3. 비밀번호 찾기(이메일 인증) 구현
4. 소켓 통신
5. 방 생성(비밀,공개)
6. 메인에서 속해있는 채팅방 바로 입장
7. 채팅 창 위치와 색을 다르게하여 상대방과 나의 채팅을 구분하기 편하게 함
8. 채팅방 처음 입장 시 메시지를 입장한 본인을 제외한 채팅방에 있는 모두에게 전송, 퇴장도 같은 동작 (12/01 추가)

------

#### 기능 수정/추가 완료
1. 인원수 변경
+ 기존 방식 : 사용자가 직접 채팅방을 생성할 때 인원수를 지정하는 방식(직접 사용자가 들어가지 않아도 지정하기만 하면 그 값이 인원수로 표기되었음, 이 방식은 친구추가 기능을 추가하면 방을 생성할 떄 친구를 초대해서 몇명을 초대했는지에 따라서 인원수를 지정하면 될것같다)
+ 수정한 방식 : 채팅방에 있는 유저의 수를 쿼리로 몇명인지 확인하고 그 수를 보여주는 방식

2. 방생성 인원수 지정 제거
+ 방생성 폼에서는 방이름, 공개방,비밀방 선택만 가능

3. 메인 폼에서 방 번호, 비번을 입력하고 들어가는 버튼에 로그인 상태를 확인하는 장치를 1개더 추가로 만들었음, 이제 chatPanelClick에서 들어가는 것에 로그인 여부를 한번더 확인하여 버그가 발생했을 떄도 채팅방에 입장하지 못하도록 구현 중

4. 테스트 중 원래 있던 방의 이름으로 방 생성을 하면 방은 생성되지만 이동하는 위치는 원래 있던 방으로 이동
   + 문제 발생 이유 : 쿼리에서 채팅방 id를 구분하는 기준을 채팅방 이름으로 쿼리를 짜서 채팅방 id가 2개가 나오니 첫번째에 나오는 id를 가져와 호출하여 이런 현상이 발생,
   + 해결 방법 
      + 채팅방을 생설할 때 시간을 데이터 베이스에 저장하고 최근에 생성된 채팅방 id를 가져오는 방식
      + 채팅방을 생성할 떄 이름이 돌일한 채팅방이 이미 있으면 생성하지 못하도록 막는 방법(사용)

5. 방 생성 후 채팅을 치지 않고 채팅방을 나가면 채팅방을 삭제

6. 방 생성 후 채팅을 치면 날짜가 나오지 않는 현상 발생
+ if (todayCount = 0) and (LastDisplayedDate <> TodayStr) then 이런식으로 변경했는데 day 값이 전부 null 인데 값을 출력해주자 않아서 and 부터 삭제함,                          

7. 메인 화면의 버튼이 로그아웃을 한 후 버튼이 비황성화 되어야하는데 안되어서 로그인 상태를 체크하여 로그인 상태가 아니라면 메시지가 뜨며 기능을 사용하지 못하도록 함

8. 테스트 중 다른 채팅방은 날짜가 정상적으로 하루에 1개만 나오는데 채팅방 1개가 채팅을 칠때마다 날짜도 같이 출력되는 중, 현재 날짜와 db에 있는 날짜를 비교해서 공백이 있으면 날짜를 출려하는 방식인데 값을 데이터베이스에서 봐보니 null이 맨위에 값에 있어서 오류가 있는 것 같음, select 값을 전부 본다음 오늘 날짜와 일치하는 값이 있으면 출력하지 않는 방식으로 수정
   + 발생이유 : 다른 채팅방의 day는 맨 앞에 있는 값이 숫자 값인데, 이 채팅방은 테스트를 할 때 day에 null이 처음으로 들어가서 쿼리에서 여러 컬럼을 뽑지만 첫번째에 있는 쿼리 값이 null이 니까 값이 없는 건줄 알고 채팅을 칠때마다 날짜를 출력하고 있음,
   + 해결 방법 : select에서 가져온 값이 전부 null 이면 출력, yyyy-mm-dd 같이 문자 값이 있으면 오늘 날짜가 출력이 안되었다면 날짜 출력, 이미 출력이 되어있으면 출력 x
   + 마지막 표시날짜와 다르고 오늘 날짜와 같은 값이 없으면 출력

9. 회원가입 시 자동으로 로그인 처리가 되도록 설계를 하였는데 로그아웃을 버튼을 눌러도 로그아웃이 되지않고 회원가입을 눌러야지 로그아웃이 되는 현상이 발생,
   + 비밀번호를 sha256으로 암호화하여 저장 중인데, 일반적으로 암호화만 하는것이 아니라 salt라느 값을 같이 데이터에 포함시켜서 데이터를 복호화하여도 정확한 원본 데이터를 구하지 못하도록 함, salt 값을 데이터와 같이 저장할 때 랜덤 값을 넣는 방법도 있고, 특정한 값을 넣는 경우도 있는데 랜덤한 값     이 경우 비밀번호를 일치하는지 확인할 때 랜덤한 값이 뭔지 모르니 어떻게 구현할지 모르곘음(구현 완료)
   + 발생 이유 : 로그인에서 로그인을 처리하는 로직이 user 테이블에 is_logged_in을 1로 바꾸어서 로그인이 되었다고 처리를 해주는데 회원가입에서는 is_logged_in을 처리해주는 로직이 없어서 오류가 발생
10. 로그인 로직도 salt를 사용하면서 pw와 salt 같을 가져와서 다시 암호화하여 같이 같은지 구분하여서 로그인 처리
--- 

#### 오류
1. (수정 완료)
   + 가끔가다 로그아웃을 해도 메인 폼에 있는 Panel이 사라지지 않는 오류가 있음, 그 상태에서 채팅방에 들어가서 채팅을 치니 일단 친 채팅의 유저 이름은 없었음, DB에는 내가 로그아웃 하기 전 로그인한 계정으로 채팅을 쳤다고 나오고, 서버에서는 아무 이름도 나오지 않음, 서버에서는 누가 채팅을 했는지 표시가 안되고 있는데 DB에서는 로그아웃 전에 로그인한 계정으로 나옴,
     + 발생 원인 : 메인창에서 Panel에 새로운 정보가 들어오면 반영이 되도록 5초 간격으로 새로고침이 되는데, 새로고침이 될 때 로그아웃을 누르면 로그인 할때 보았던 Panel이 나오고 사용도 할 수 있는 상황이 발생한다.
     + 해결 방법
        1. 메인에서 Panel을 클릭할 떄 로그인 정보를 확인하지 않고 바로 입장하는데 이런 오류 상활을 위해서 로그인 확인 로직을 구현(구현)
        2. 로그아웃 버튼을 누르면 Timer1.Enabled := False;로 만들어서 새로고침이 발생하지 않도록 한다. 
        3. 로그아웃 할 때 CurrentUser.UserNo 값을 초기화하여 userno를 불러오지 못하도록한다.
<img width="601" height="429" alt="image" src="https://github.com/user-attachments/assets/8644a3cb-86ec-4d31-a47c-b5b5ec8aa66a" />
<img width="737" height="38" alt="image" src="https://github.com/user-attachments/assets/3a9558f5-f2f9-4418-801a-ddca7df79a4c" />

2. form13에서 create form도 아닌데 실행하면 PopulateAllFriends이 프로시저에 있는 Showmeesage가 프로그램을 시작하자 마자 출력됨, Form13을 아래 처럼 두면 방금 말한 현상이 발생하고, 오른쪽에 두면 2번쨰 사진처럼 오류 발생
   + 해결 방법
   + 기존 호출 방식
    ```
    Form13.ShowModal;
    ```
   + 수정   
    ```
    if not Assigned(Form13) then
    Form13 := TForm13.Create(Application);
     try
       Form13.ShowModal;
     finally
       FreeAndNil(Form13);  // 사용 후 해제
     end;
    ```
     Form13을 동적으로 호출하여 오류를 제거함
<img width="417" height="204" alt="image" src="https://github.com/user-attachments/assets/560c96ed-b680-48f2-8831-6d21e65ee9d3" />
<img width="344" height="145" alt="image" src="https://github.com/user-attachments/assets/e0cd8b27-1114-44c3-af30-f4c3aebbb2d1" />


---

#### 기능 추가 구현
1. 친구 추가 기능 : 마이페이지에서 친구 확인, 친구 추가 수락 버튼(클릭 시 1에서 2로 변경), 거절 버튼(1에서 0으로 변경), DB에 친구 컬럼을 만들어서 기본은 0, 친구 추가 요청 1, 친구 추가 2로 변경 , 채팅방 생성 시 친구들 초대하여 바로 친구들과 채팅 가능, 새로운 폼에서 친구 목록에서 클릭하여 선택 가능, 보낸 유저의 대한 컬럼 값도 추가, 테이블 구조가 id, 보낸 user, 받은 user, 상태를 나타내고 있음, 1번이 2번에게 친구 요청 -> 요청 수락 -> 2번이 1번에게 친구 요청 이런식의 경우가 가능할 것 같음, 이를 막을려면 1번이 2번에게 보낸 친구 요청을 수락하면 수락 상태를 나타내야 하는데 어디서 나타내야 하는지 모르겠음
+ 채팅방 생성 설계 : 채팅 방 생성을 누르면 폼을 보여주고 거기서 어떤 채팅방을 생성할 것안지 선택, 채팅 방에 유저를 초대하고 방을 생성하는 form 생성
+ 채팅방 생성을 일반 , 공개방 버튼을 누르는 방식으로 변경 , 클릭한 버튼에 따라서 chattype을 가지고 그 값을 form13에 전달하여 어떤 방인지 확인 후 생성
+ 친구 추가를 하는 위치 : 채팅방 정보를 보는 곳에서 유저를 클릭하여 친구 추가, 메인에서 유저 이름을 검색하여 친구 추가
+ 구현 사항 : form8에서 기존에 있던 버튼들을 업애고 일반 채팅, 공개 채팅 버튼에 따라서 ChatType 값으로 비번 유무를 결정한 후 친구 초대 혹은 바로 방 생성
+ 추가할 부분 : 내가 친구 요청 보낸 유저 확인, 나에게 온 친구 요청 확인, 나와 친구인 유저 확인
+ 내가 친구 요청 보낸 유저 확인 : select receiver_id from friend where requester_id = myid;
+ 나에게 온 친구 요청 확인 : select requester_id from friend where receiver_id = myid; 
+ 나와 친구인 유저 확인

2, 채팅방 생성 시 한번에 1명의 유저만 선택 가능, 한번에 여러 유저를 선택 가능하도록 변경, 한국어 ???로 표시 

---
  
##### 테스트 주의 사항 
1. 로그인을 하고 로그아웃을 하지않고 프로그램을 종료하면 user 테이블에 is_logged_in이 1로 되어있어서 이미 로그인 되었습니다. 라고 나오니 로그아웃을 잘 누르거나, 직접 sql에서 is_logged_in을 0으로 변경

---

### rest api 
1. 사용자 생성,조회,삭제,수정 등 기능을 URL을 호출하면 바로 실행되도록 만들었음
